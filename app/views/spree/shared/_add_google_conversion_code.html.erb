<% unless SpreeThemeSettings::Config.google_ad_id.blank? %>
  <!-- Google Ads Remarketing Tag  START -->
  <%
  google_ads_conversion_id = SpreeThemeSettings::Config.google_ad_id
  google_ads_conversion_label = SpreeThemeSettings::Config.google_ad_conversion_id
  %>
  <!-- Global site tag (gtag.js) - Ads. -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=AW-<%= google_ads_conversion_id %>"></script>
  <script type="text/javascript">
      window.dataLayer = window.dataLayer || [];

      function gtag() {
          dataLayer.push(arguments);
      }

      gtag('js', new Date());
      gtag('config', 'AW-<%= google_ads_conversion_id %>');
  </script>
  <!-- Global site tag (gtag.js) - Ads. -->

  <% if controller_name == 'orders' && action_name == 'show' && @order.present? %>
  <%
  order_id = @order.number
  order_currency = @order.currency
  order_value = @order.total&.to_f
  address = @order&.ship_address
  %>
  <script type="text/javascript">
  gtag('event', 'conversion', {
    'send_to': 'AW-<%= google_ads_conversion_id %>/<%= google_ads_conversion_label %>',
    'transaction_id': '<%= order_id %>',
    'value': <%= order_value %>,
    'currency': '<%= order_currency %>'
  });

  gtag('event', 'order_complete', {
    'order_id': "<%= order_id %>",
    'order_value': <%= order_value %>,
    'order_currency': "<%= order_currency %>",
    'enhanced_conversion_data':  {
      "email": "<%= @order.email %>",
      "first_name": "<%= address&.firstname %>",
      "last_name": "<%= address&.lastname %>",
      "home_address": {
        "street": "<%= address&.address1 %>",
        "city": "<%= address&.city %>",
        "region": "<%= address&.state_text %>",
        "postal_code": "<%= address&.zipcode %>",
        "country": "<%= address&.country&.iso&.to_s %>"
      }
    }
  });

  gtag('set', 'user_data', {
    'email': "<%= @order.email %>",
    <% unless address&.phone.blank? %>
    'phone_number': "<%= address.phone %>",
    <% end %>
    'address': {
      'first_name': "<%= address&.firstname %>",
      'last_name': "<%= address&.lastname %>",
      'street': "<%= address&.address1 %>",
      'city': "<%= address&.city %>",
      'region': "<%= address&.state_text %>",
      'postal_code': "<%= address&.zipcode %>",
      'country':  "<%= address&.country&.iso %>"
    }
  });
  </script>
  <% end %>
<% end %>
